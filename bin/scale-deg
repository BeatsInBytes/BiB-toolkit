#!/bin/bash

argList=$(for i; do echo $i; done)

fileNum=$(echo "$argList" | grep -v '-' | grep . | wc -l | tr -d ' ')

if [ $fileNum -gt 1 ]; then
    echo "
    keysig: ERROR: $fileNum input files; only 1 supported
"
    exit 1;
fi

header=$(cat $1 | head -n $(cat $1 | grep -n '=' | head -n 1 | cut -d ':' -f1) | sed -e s/**kern/**scale-deg/ )

tailNum=$(echo "$(cat $1 | wc -l)-$(cat $1 | grep -n '*-' | head -n 1 | cut -d ':' -f1)" | bc)
footer=$(cat $1 | tail -n $tailNum)

# while IFS= read -r line
# do
#   echo "$line" | grep '!\|*' 
# done < "$1"
content=$(cat $1 | head -n $(cat $1 | grep -n '*-' | head -n 1 | cut -d ':' -f1) | tail -n +$(cat $1 | grep -n '=' | head -n 1 | cut -d ':' -f1) | grep -v '*\|!')

tracknum=$(tracknum $1)
for i in $(seq $tracknum); do
    line=$(echo "$content" | tr '\t' '~' | cut -d '~' -f$i | tr -d '(\|)\|[\|]')
    while IFS= read -r subline; do
        if [ -z "$subline" ]; then
            echo "EMPTY"
        else
            if [ "$subline" == '.' ]; then
                echo "dot"
            else
                echo $subline
            fi
        fi
    done <<< "$line"
done

# echo "$header
# CONTENT
# $footer"