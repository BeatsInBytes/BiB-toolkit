#!/bin/bash

usageMessage="scale-deg: Usage: "

argList=$(for i; do echo $i; done)

fileNum=$(echo "$argList" | grep -v '-' | grep . | wc -l | tr -d ' ')

file=$(echo "$argList" | grep -v '-' | grep .)

if [ $fileNum -gt 1 ]; then
    echo "
    scale-deg: ERROR: $fileNum input files; only 1 supported
"
    exit 1;
elif [ $fileNum -eq 0 ]; then
    echo "
    scale-deg: ERROR: No input file specified
"
    exit 1;
elif [ $fileNum -eq 1 ]; then
    if [[ ! -f $file ]]; then
    echo "
    scale-deg: ERROR: Input file '$file' not found.
"        
    exit 1
    fi
fi

header=$(cat $1 | head -n $(cat $1 | grep -n '=' | head -n 1 | cut -d ':' -f1) | sed -e s/**kern/**scale-deg/ )

tailNum=$(echo "$(cat $1 | wc -l)-$(cat $1 | grep -n '*-' | head -n 1 | cut -d ':' -f1)" | bc)
footer=$(cat $1 | tail -n $tailNum)

content=$(cat $1 | head -n $(cat $1 | grep -n '*-' | head -n 1 | cut -d ':' -f1) | tail -n +$(cat $1 | grep -n '=' | head -n 1 | cut -d ':' -f1) | grep -v '*\|!')
echo "$header"
tracknum=$(tracknum $1)
for i in $(seq $tracknum); do
    track=$(echo "$content" | tr '\t' '~' | cut -d '~' -f$i | tr -d '(\|)\|[\|]')
    rhythm=$(echo "$track" | sed 's/[^0-9]*/ /g' | perl -p -e 's/^ *//' | sed -e 's/ /|~/g' | sed -e 's/^$/./')
    echo "$rhythm"
done

# echo "$header
# CONTENT
# $footer"