#!/bin/bash

# The usage message when errors are made
#==========================================
usageMessage="ERROR: usage: meta [-chnt] <inputfile>"

# Read all the arguments and files input
#==========================================
argList=$(for i; do echo $i; done)
fileNum=$(echo "$argList" | grep -v '-' | grep . | wc -l | tr -d ' ')
file=$(echo "$argList" | grep -v '-' | grep .)

# FILE ERROR HANDLING:
#============================
    if [ $fileNum -gt 1 ]; then
        echo "
        meta: ERROR: $fileNum input files; only 1 supported
    "
        exit 1;
    elif [ $fileNum -eq 0 ]; then
        echo "
        meta: ERROR: No input file specified
    "
        exit 1;
    elif [ $fileNum -eq 1 ]; then
        if [[ ! -f $file ]]; then
        echo "
        meta: ERROR: Input file '$file' not found.
    "        
        exit 1
        fi
    fi

#ARG ERROR HANDLING:
#============================
singopt=$(echo "$argList" | grep -v -- '--' | grep ^- | grep . | tr -d '-' | grep . | grep -o .)
singoptNum=$(echo "$singopt" | wc -l)

singUnrec=$(echo "$singopt" | grep -v 'c\|h\|n\|t' | grep .)
singUnrecNum=$(echo "$singUnrec" | grep . | wc -l | tr -d ' ')

doub=$(echo "$argList" | grep -- '--' | grep . )
doubNum=$(echo "$doub" | wc -l)

if [[ ! -z "$doub" ]]; then
    echo "$usageMessage"
    echo "
The following are not recoginzed options for the meta program:"
    for i in $(seq 1 "$doubNum"); do
        line=$(echo "$doub" | sed "${i}q;d")
        printf "     "
        echo ${line}
    done
    exit 1
fi


if [ -z "$singUnrec" ]; then
    echo 'all set'
else
    echo "$usageMessage"
    echo "
The following are not recoginzed options for the meta program:"
    for i in $(seq 1 "$singUnrecNum"); do
        line=$(echo "$singUnrec" | sed "${i}q;d")
        printf "   -"
        echo ${line}
    done
    exit 1
fi
